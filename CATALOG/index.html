<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог - RAGE</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Возможно, понадобится подключить шрифты -->
</head>
<body>
    <div class="container">
        <!-- ДОБАВЛЕНО: Статус бар -->
        <header class="status-bar">
            <div class="time"></div>
            <div class="status-icons"></div>
        </header>

        <!-- ДОБАВЛЕНО: Контейнер для верхних иконок поверх шапки -->
        <div class="top-icons-container">
            <button class="icon-button">
                <img src="../assets/Icons left.svg" alt="Назад">
            </button>
            <button class="icon-button">
                <img src="../assets/Account.svg" alt="Аккаунт">
            </button>
        </div>

        <!-- ДОБАВЛЕНО: Фон шапки -->
        <div class="header-background"></div>

        <!-- ДОБАВЛЕНО: Анимированная текстура фона -->
        <div class="background-texture"></div>

        <main class="main-content">
            <!-- Поиск -->
            <section class="shop-search">
                <div class="search-bar">
                    <img src="../assets/search_icon.svg" alt="Поиск" class="search-icon">
                    <input type="text" placeholder="Search">
                </div>
            </section>

            <!-- Навигация / Фильтр -->
            <nav class="shop-nav">
                <span class="popular-text">Popular</span>
                <button class="icon-button">
                    <img src="../assets/Icon menu.svg" alt="Фильтр">
                </button>
            </nav>

            <!-- Сетка товаров -->
            <section class="shop-grid">
                <!-- Пары карточек -->
                <div class="product-card-pair">
                    <!-- Карточка товара 1 -->
                    <article class="product-card" data-product-id="product-1">
                        <div class="product-image-container">
                            <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                    <!-- Карточка товара 2 -->
                    <article class="product-card" data-product-id="product-2">
                        <div class="product-image-container">
                             <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                </div>
                <!-- ... другие пары карточек ... -->
                 <div class="product-card-pair">
                     <article class="product-card" data-product-id="product-3">
                        <div class="product-image-container">
                             <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                     <article class="product-card" data-product-id="product-4">
                        <div class="product-image-container">
                             <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                </div>
                <div class="product-card-pair">
                     <article class="product-card" data-product-id="product-5">
                        <div class="product-image-container">
                             <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                     <article class="product-card" data-product-id="product-6">
                        <div class="product-image-container">
                             <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                </div>
                <div class="product-card-pair">
                     <article class="product-card" data-product-id="product-7">
                        <div class="product-image-container">
                             <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                     <article class="product-card" data-product-id="product-8">
                        <div class="product-image-container">
                             <img src="../assets/Image placeholder.svg" alt="" class="product-image placeholder">
                        </div>
                        <div class="product-info">
                            <span class="product-price">$239.80</span>
                            <h3 class="product-name">Nike Air Max 90</h3>
                        </div>
                    </article>
                </div>
            </section>
        </main>

        <!-- Нижняя навигация -->
        <footer class="bottom-nav">
            <div class="nav-icons">
                <a href="../HOMEPAGE/index.html" class="nav-icon">
                    <img src="../assets/home1.svg" alt="Домой">
                </a>
                <a href="#" class="nav-icon active">
                    <img src="../assets/catalog1.svg" alt="Каталог">
                    <div class="nav-slider"></div>
                </a>
                <a href="../FAVORITE/index.html" class="nav-icon">
                    <img src="../assets/favorite.svg" alt="Избранное">
                </a>
                <a href="../CART/index.html" class="nav-icon">
                    <img src="../assets/shopping_cart.svg" alt="Корзина">
                </a>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- UPDATED: Vertical Bounce Logic (Overscroll Only) --- 
            const mainContent = document.querySelector('.main-content');
            const scrollableList = document.querySelector('.shop-grid'); // Target list

            if (mainContent && scrollableList) {
                let startY = 0;
                let startScrollTop = 0;
                let currentTranslateY = 0;
                let isDraggingBounce = false;
                let pointerId = null;
                let animationFrameIdBounce = null;
                const maxBounce = 80; 
                const decayFactor = maxBounce * 1.5; 

                const getTranslateY = (element) => {
                    const style = window.getComputedStyle(element);
                    const matrix = new DOMMatrix(style.transform);
                    return matrix.m42;
                };

                // Apply transform using rAF
                const applyTransform = (translateY) => {
                    if (animationFrameIdBounce) cancelAnimationFrame(animationFrameIdBounce);
                    animationFrameIdBounce = requestAnimationFrame(() => {
                        scrollableList.style.transition = 'none'; 
                        scrollableList.style.transform = `translateY(${translateY}px)`;
                    });
                };

                mainContent.addEventListener('pointerdown', (e) => {
                    // --- MODIFIED CHECK START ---
                    // If the pointerdown starts inside a product card, or on any other
                    // explicitly interactive element, ignore it for the bounce effect.
                    if (e.target.closest('.product-card') || e.target.closest('button, a, input')) {
                        return; // Let the click/interaction happen normally
                    }
                    // Also ignore right-clicks etc.
                    if (e.button !== 0) {
                        return;
                    }
                    // --- MODIFIED CHECK END ---

                    // If we are here, the pointerdown is on the scrollable background
                    isDraggingBounce = true;
                    pointerId = e.pointerId;
                    startY = e.clientY;
                    startScrollTop = mainContent.scrollTop; // Record initial scroll position
                    currentTranslateY = getTranslateY(scrollableList); // Get current bounce 
                    mainContent.style.cursor = 'grabbing';
                    if (animationFrameIdBounce) cancelAnimationFrame(animationFrameIdBounce);
                    animationFrameIdBounce = null;
                    // Explicitly set capture to the mainContent element
                    mainContent.setPointerCapture(pointerId); 

                    // Disable CSS transition only when starting drag
                    scrollableList.style.transition = 'none';
                }, { passive: false }); 

                mainContent.addEventListener('pointermove', (e) => {
                    if (!isDraggingBounce || e.pointerId !== pointerId) return;

                    const currentY = e.clientY;
                    const deltaYTotal = currentY - startY;
                    
                    // Calculate the scrollTop if we let the browser scroll naturally
                    const potentialScrollTop = startScrollTop - deltaYTotal;
                    const maxScrollTop = mainContent.scrollHeight - mainContent.clientHeight;

                    let overscroll = 0;

                    if (potentialScrollTop < 0) { 
                        // Trying to scroll past the top
                        overscroll = potentialScrollTop;
                        mainContent.scrollTop = 0; // Prevent native scroll
                        e.preventDefault(); // Prevent default scroll behavior
                    } else if (potentialScrollTop > maxScrollTop) {
                        // Trying to scroll past the bottom
                        overscroll = potentialScrollTop - maxScrollTop;
                        mainContent.scrollTop = maxScrollTop; // Prevent native scroll
                         e.preventDefault(); // Prevent default scroll behavior
                    } else {
                        // Scrolling within bounds - allow native scroll, reset bounce
                        if(getTranslateY(scrollableList) !== 0) {
                           applyTransform(0);
                        }
                        // DO NOT prevent default, let the browser handle scrolling
                        return; 
                    }

                    // Calculate bounce translation based on overscroll amount
                    const targetTranslateY = maxBounce * Math.sign(-overscroll) * 
                                           (1 - Math.exp(-Math.abs(overscroll) / decayFactor));
                    applyTransform(targetTranslateY);
                    
                }, { passive: false }); // passive: false because we call preventDefault

                const handlePointerEndBounce = (e) => {
                    if (!isDraggingBounce || e.pointerId !== pointerId) return;
                    
                    isDraggingBounce = false;
                    pointerId = null;
                    mainContent.style.cursor = 'grab'; 
                    if (animationFrameIdBounce) cancelAnimationFrame(animationFrameIdBounce);
                    animationFrameIdBounce = null;

                    // Reset styles to allow CSS transition back to origin
                    scrollableList.style.transition = ''; 
                    scrollableList.style.transform = '';

                    // Release pointer capture
                    if (mainContent.hasPointerCapture(e.pointerId)) {
                        mainContent.releasePointerCapture(e.pointerId);
                    }
                };

                mainContent.addEventListener('pointerup', handlePointerEndBounce);
                mainContent.addEventListener('pointercancel', handlePointerEndBounce);
                mainContent.addEventListener('lostpointercapture', handlePointerEndBounce);
            }
            // --- END: Vertical Bounce Logic ---

            // --- NEW: Product Detail Modal Logic ---
            const shopGrid = document.querySelector('.shop-grid');
            const modalOverlay = document.getElementById('product-detail-modal');
            const modalCloseBtn = modalOverlay.querySelector('.modal-close-btn');
            // Get refs to modal content elements if needed later for population
            const modalProductName = document.getElementById('modal-product-name');
            const modalProductPrice = document.getElementById('modal-product-price');
            const modalProductDesc = document.getElementById('modal-product-desc');
            const modalProductImg = document.getElementById('modal-product-img');
            // Add refs for size, color, quantity, add-to-cart if needed

            if (shopGrid && modalOverlay && modalCloseBtn) {
                
                // Function to open the modal
                const openModal = (productId) => {
                    console.log("Opening modal for product:", productId);
                    // TODO: Fetch product data based on productId and populate modal elements
                    // For now, just using placeholders
                    modalProductName.textContent = `Product Name (${productId})`; // Example population
                    modalProductPrice.textContent = `$${Math.floor(Math.random() * 200) + 50}.99`; // Random price
                    modalProductDesc.textContent = `Details for product ${productId} will go here. This is placeholder text.`;
                    modalProductImg.src = `../assets/Image placeholder.svg`; // Placeholder image
                    
                    modalOverlay.classList.add('modal-visible');
                };

                // Function to close the modal
                const closeModal = () => {
                    modalOverlay.classList.remove('modal-visible');
                };

                // Event listener for clicks on the product grid
                shopGrid.addEventListener('click', (e) => {
                    const productCard = e.target.closest('.product-card');
                    if (productCard) {
                        e.preventDefault(); // Prevent default if card itself is a link
                        const productId = productCard.dataset.productId;
                        if (productId) {
                            openModal(productId);
                        }
                    }
                });

                // Event listener for the close button
                modalCloseBtn.addEventListener('click', closeModal);

                // Optional: Close modal if overlay background is clicked
                modalOverlay.addEventListener('click', (e) => {
                    // Check if the click is directly on the overlay, not the content inside
                    if (e.target === modalOverlay) {
                        closeModal();
                    }
                });
            }
            // --- END: Product Detail Modal Logic ---

        });
    </script>

    <!-- NEW: Product Detail Modal -->
    <div id="product-detail-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">
                 <img src="../assets/icon_close.svg" alt="Close"> <!-- Placeholder Icon -->
            </button>
            
            <div class="modal-product-image">
                <img src="../assets/Image placeholder.svg" alt="Product Image Placeholder" id="modal-product-img"> 
            </div>
            
            <h2 class="modal-product-name" id="modal-product-name">Product Name Placeholder</h2>
            <span class="modal-product-price" id="modal-product-price">$0.00</span>
            
            <div class="modal-product-description">
                <p id="modal-product-desc">Product description placeholder. More details about the product will go here.</p>
            </div>
            
            <div class="modal-options">
                 <div class="modal-option-group">
                    <label for="size-select">Size:</label>
                    <select name="size" id="size-select">
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                    </select>
                </div>
                 <div class="modal-option-group">
                    <label for="color-select">Color:</label>
                    <div class="color-options">
                         <button class="color-option" style="background-color: #000000;" data-color="black"></button>
                         <button class="color-option" style="background-color: #FFFFFF; border: 1px solid #ccc;" data-color="white"></button>
                         <button class="color-option" style="background-color: #CCCCCC;" data-color="grey"></button>
                         <!-- Add more colors as needed -->
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <div class="quantity-selector">
                     <button class="quantity-btn minus">-</button>
                     <span class="quantity-value">1</span>
                     <button class="quantity-btn plus">+</button>
                </div>
                <button class="add-to-cart-modal-btn">Add to Cart</button>
            </div>
            
        </div>
    </div>
    <!-- END: Product Detail Modal -->

</body>
</html> 